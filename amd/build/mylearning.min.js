define("local_course/mylearning",["jquery","core/ajax","core/templates","core/str","core/url","core/notification","core/custom_interaction_events","core/popover_region_controller"],(function($,Ajax,Templates,Str,URL,DebugNotification,CustomEvents,PopoverController){var SELECTORS_ALL_LEARNING_CONTAINER='[data-region="all-learning"]',MyLearningPopoverController=function(element){PopoverController.call(this,element),this.contextid=this.root.attr("data-contextid"),this.container=this.root.find(SELECTORS_ALL_LEARNING_CONTAINER),this.loadedAll=!1};return(MyLearningPopoverController.prototype=Object.create(PopoverController.prototype)).constructor=MyLearningPopoverController,MyLearningPopoverController.prototype.updateButtonAriaLabel=function(){this.isMenuOpen()?Str.get_string("hidenotificationwindow","message").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):this.unreadCount?Str.get_string("shownotificationwindowwithcount","message",this.unreadCount).done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this)):Str.get_string("shownotificationwindownonew","message").done(function(string){this.menuToggle.attr("aria-label",string)}.bind(this))},MyLearningPopoverController.prototype.getContent=function(){return this.container},MyLearningPopoverController.prototype.hasLoadedAllContent=function(){return this.loadedAll},MyLearningPopoverController.prototype.setLoadedAllContent=function(val){this.loadedAll=val},MyLearningPopoverController.prototype.loadMyLearning=function(){if(this.isLoading||this.hasLoadedAllContent())return $.Deferred().resolve();this.startLoading();var container=this.getContent();Ajax.call([{methodname:"local_course_get_my_learning",args:{contextid:this.contextid}}])[0].done(function(response){return this.setLoadedAllContent(!0),this.renderMyLearning(JSON.parse(response.courses),container)}.bind(this)).fail(function(){}.bind(this)).always(function(){this.stopLoading()}.bind(this))},MyLearningPopoverController.prototype.renderMyLearning=function(courses,container){var promises=[];return $.each(courses,function(index,course){var promise=Templates.render("local_course/mylearning_course",course).then((function(html,js){return{html:html,js:js}}));promises.push(promise)}.bind(this)),$.when.apply($,promises).then((function(){$.each(arguments,(function(index,argument){container.append(argument.html),Templates.runTemplateJS(argument.js)}))}))},MyLearningPopoverController.prototype.registerEventListeners=function(){CustomEvents.define(this.root,[CustomEvents.events.activate]),this.root.on(this.events().menuOpened,function(){this.updateButtonAriaLabel(),this.hasLoadedAllContent()||this.loadMyLearning()}.bind(this)),this.root.on(this.events().menuClosed,function(){this.updateButtonAriaLabel()}.bind(this)),this.root.on(this.events().startLoading,function(){this.getContent().attr("aria-busy","true")}.bind(this)),this.root.on(this.events().stopLoading,function(){this.getContent().attr("aria-busy","false")}.bind(this))},MyLearningPopoverController}));

//# sourceMappingURL=mylearning.min.js.map